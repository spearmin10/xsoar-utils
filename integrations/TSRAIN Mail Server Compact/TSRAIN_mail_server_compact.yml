commonfields:
  id: TSRAIN mail server compact
  version: -1
vcShouldKeepItemLegacyProdMachine: false
name: TSRAIN mail server compact
display: TSRAIN mail server compact
category: Utilities
image: data:image/png;base64,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
description: Air-gapped email server working on an integration instance.
detaileddescription: |-
  ### How to configure an instance.

  #### 0.  Go to ABOUT > Troubleshooting > Server Configuration
    Set  instance.execute.external = true

  #### 1. Create an instance
  Add instance with the parameters below:
    - Instance Name: tsrain
    - Listen Port: 8118

  You can access the webmail UI at
    - https://xsoar-server/instance/execute/tsrain/
    - http://xsoar-server:8118/
      ```
        username: any email address (e.g. test@test.lan)
        password: Password123$
      ```

  Admin UI
    - https://xsoar-server/instance/execute/tsrain/?admin
    - http://xsoar-server:8118/?admin
      ```
         username: admin
         password: <Run !tsrc-get-default-admin-password>
      ```

  #### 2. Get the gateway address of the docker bridge network
  Run !tsrc-get-gateways in CLI, and memorize the gateway IP for 3 and 4

  #### 3. (Optional) Configure 'Mail Sender (New)' to connect to the server.
  Add an instance with the parameters below:
    - Mail server hostname or IP address: <gateway IP>
    - SMTP Port: 8118
    - Sender address: any email address

  #### 4. (Optional) Configure 'Mail Listener v2' to connect to the server.
  Add an instance with the parameters below:
    - Mail server hostname or IP address: <gateway IP>
     - IMAP Port: 8118
     - Username: your email address
     - Password: Password123$
     - Incoming mail folder: INBOX
     - Use TLS for connection: Yes
     - Trust any certificate (not secure): Yes

  ### NOTE:
   - Emails are stored in memory. All the emails are gone whenever restarting the docker container.
configuration:
- display: Long Running Instance
  name: longRunning
  defaultvalue: "true"
  type: 8
  required: false
- display: Listen Port
  name: longRunningPort
  defaultvalue: "8118"
  type: 0
  required: true
  additionalinfo: The port which is shared with Rainloop Web UI, SMTP and IMAP4
- display: Incident type
  name: incidentType
  type: 13
  required: false
- display: User's mailbox password
  name: mailboxPassword
  defaultvalue: Password123$
  type: 4
  required: false
  additionalinfo: The password is applied for all the users, default password is 'Password123$'
- display: Default 'admin' password
  name: deafultAdminPassword
  type: 4
  required: false
  additionalinfo: The password is randomly generated by default
script:
  script: |-
    import os
    import time
    import socket
    import select
    import string
    import random
    import ssl
    import subprocess
    import traceback
    import ipaddress
    import netifaces
    from socketserver import BaseServer, BaseRequestHandler, ThreadingTCPServer
    from multiprocessing import Process
    from typing import Tuple, List, Dict, Any


    SMTP_PORT = 10025
    POP3_PORT = 10110
    IMAP4_PORT = 10143
    RAINLOOP_PORT = 10080

    DEFAULT_SOCKET_TIMEOUT = 30
    DEFAULT_PUBLIC_KEY_SIZE = 2048
    DEFAULT_MAILBOX_PASSWORD = 'Password123$'
    INTEGRATION_NAME = 'XSOAR tsrain mail server compact'


    def update_context(params: Dict[str, Any]) -> Dict[str, Any]:
        """
        Store the integration parameters to the integration context.

        :param params: The integration parameters
        :return: The integration context updated.
        """
        x = demisto.getIntegrationContext() or {}
        for k in ('deafultAdminPassword', 'mailboxPassword'):
            if k in params:
                x[k] = params.get(k, '')

        if not params.get('deafultAdminPassword') and not x.get('deafultAdminPasswordGenerated'):
            # Generate password randomly when the default passwod is not specified
            x['deafultAdminPasswordGenerated'] =\
                ''.join([random.choice(string.ascii_letters + string.digits + '$#!.@+/=_') for i in range(32)])

        demisto.setIntegrationContext(x)
        return x


    def get_default_admin_password(params: Dict[str, Any]) -> str:
        """
        Retrieve default admin password

        :param params: The integration parameters
        :return: The default admin password.
        """
        x = update_context({'deafultAdminPassword': params.get('deafultAdminPassword')})
        return x.get('deafultAdminPassword', '') or x.get('deafultAdminPasswordGenerated', '')


    def is_restart_required(params: Dict[str, Any]) -> bool:
        """
        Check if the service restart is required

        :param params: The integration parameters
        :return: True - restart is required.
        """
        x = demisto.getIntegrationContext()
        if x:
            for k in ('deafultAdminPassword', 'mailboxPassword'):
                if x.get(k, '') != params.get(k, ''):
                    return True
        return False


    def start_services(params: Dict[str, Any], restart: bool = False):
        """
        Start services

        :param params: The integration parameters
        :param restart: True if it re-starts the service.
        """
        os.environ['SMTP_PORT'] = str(SMTP_PORT)
        os.environ['POP3_PORT'] = str(POP3_PORT)
        os.environ['IMAP4_PORT'] = str(IMAP4_PORT)
        os.environ['RAINLOOP_PORT'] = str(RAINLOOP_PORT)
        os.environ['MAILBOX_PASSWORD'] = params.get('mailboxPassword') or DEFAULT_MAILBOX_PASSWORD
        os.environ['RAINLOOP_DEFAULT_ADMIN_PASSWORD'] = get_default_admin_password(params)
        ret = subprocess.call(['restart.sh' if restart else 'start.sh'])
        demisto.debug('A {}start command has been requested: {}'.format('re' if restart else '', ret))


    def get_gateway_interfaces() -> List[Dict[str, str]]:
        """
        Get the gateway interfaces

        :return: List of interfaces (keys: 'IP', 'Interface', 'Default')
        """
        return [{
            'IP': a[0] if len(a) > 0 else None,
            'Interface': a[1] if len(a) > 1 else None,
            'Default': a[2] if len(a) > 2 else None
        } for k, v in netifaces.gateways().items() if k != 'default' for a in v]


    def get_local_addresses() -> List[dict]:
        """
        Get local addresses

        :return: List of local address object {'addr', 'netmask', 'broadcast'}
        """
        alist = []
        for ifname in netifaces.interfaces():
            ifinfo = netifaces.ifaddresses(ifname)
            for ininfo in ifinfo.values():
                for ainfo in ininfo:
                    if ainfo.get('addr') and ainfo.get('netmask'):
                        try:
                            addr = ipaddress.ip_address(ainfo['addr'])
                            mask = ipaddress.ip_network(ainfo['netmask'], strict=False)
                            exploded = mask.broadcast_address.exploded
                            if addr.version == 4:
                                bcast = ipaddress.IPv4Address(int(addr) | (0xffffffff ^ int(ipaddress.IPv4Address(exploded))))
                                alist.append({
                                    'addr': addr,
                                    'netmask': mask,
                                    'broadcast': bcast
                                })
                        except ValueError:
                            pass
        return alist


    def save_server_address(ips: Optional[List[str]], port: Optional[int]):
        """
        Save the server addresses to the integration context

        :param ips: The list of IP addresses of the server
        :param port: The port number
        """
        if port is None:
            ips = None
        elif not ips:
            ips = [a['addr'].exploded for a in get_local_addresses() if not a['addr'].is_loopback]

        x = demisto.getIntegrationContext() or {}
        if ips is None:
            x.pop('ServerAddresses', None)
        else:
            x['ServerAddresses'] = json.dumps([{
                'Host': ip,
                'Port': port
            } for ip in ips])
        demisto.setIntegrationContext(x)


    def create_ssl_server_context() -> ssl.SSLContext:
        """
        Create a SSL server context

        :return: a SSL server context
        """
        cert_file = '/dev/shm/tsc.cer.pem'
        key_file = '/dev/shm/tsc.key.pem'
        cert, key = gen_self_signed_server_cert(DEFAULT_PUBLIC_KEY_SIZE)
        with open(cert_file, 'wb') as f:
            f.write(cert)
        with open(key_file, 'wb') as f:
            f.write(key)

        ssl_ctx = ssl.create_default_context(ssl.Purpose.CLIENT_AUTH)
        ssl_ctx.load_cert_chain(certfile=cert_file, keyfile=key_file)
        return ssl_ctx


    def gen_self_signed_server_cert(key_size: int) -> Tuple[bytes, bytes]:
        """
        Generate a self signed server certificate

        :param key_size: The length of a public key to be generated.
        :return: A certificate and private key pair in PEM
        """
        from cryptography import x509
        from cryptography.hazmat.backends import default_backend
        from cryptography.hazmat.primitives import hashes
        from cryptography.hazmat.primitives.asymmetric import rsa
        from cryptography.hazmat.primitives import serialization
        from cryptography.x509.oid import NameOID

        valid_from = datetime.now()
        valid_until = valid_from + timedelta(1 * 365, 0, 0)

        hostname = socket.gethostname()
        private_key = rsa.generate_private_key(public_exponent=65537, key_size=key_size, backend=default_backend())
        public_key = private_key.public_key()

        builder = x509.CertificateBuilder()
        builder = builder.subject_name(x509.Name([x509.NameAttribute(NameOID.COMMON_NAME, hostname)]))
        builder = builder.issuer_name(x509.Name([x509.NameAttribute(NameOID.COMMON_NAME, hostname)]))
        builder = builder.not_valid_before(valid_from)
        builder = builder.not_valid_after(valid_until)
        builder = builder.serial_number(x509.random_serial_number())
        builder = builder.public_key(public_key)
        builder = builder.add_extension(
            x509.SubjectAlternativeName([
                x509.DNSName(hostname),
                x509.DNSName('localhost')
            ]),
            critical=False)
        builder = builder.add_extension(x509.BasicConstraints(ca=False, path_length=None), critical=True)

        certificate = builder.sign(
            private_key=private_key, algorithm=hashes.SHA256(),
            backend=default_backend())

        return (certificate.public_bytes(serialization.Encoding.PEM),
                private_key.private_bytes(serialization.Encoding.PEM,
                                          serialization.PrivateFormat.PKCS8,
                                          serialization.NoEncryption()))


    class PortForwardingHandler(BaseRequestHandler):
        """
        Port Forwarding for the services
        """
        ssl_server_context = create_ssl_server_context()

        def __init__(self, request, client_address, server):
            BaseRequestHandler.__init__(self, request, client_address, server)

        def forward_tcp_tcp(self, port: int):
            """
            Port Forwarding: tcp-tcp:port
            """
            cs = self.request
            try:
                with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as rs:
                    rs.connect(('127.0.0.1', port))
                    while True:
                        r, w, x = select.select([cs, rs], [], [])
                        if cs in r:
                            payload = cs.recv(1024)
                            if len(payload) == 0:
                                break
                            rs.send(payload)
                        if rs in r:
                            payload = rs.recv(1024)
                            if len(payload) == 0:
                                break
                            cs.send(payload)
            except Exception:
                demisto.debug(traceback.format_exc())
            finally:
                cs.close()

        def forward_ssl_tcp(self, port: int):
            """
            Port Forwarding: ssl-tcp:port
            """
            try:
                with PortForwardingHandler.ssl_server_context.wrap_socket(self.request, server_side=True) as cs:
                    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as rs:
                        rs.connect(('127.0.0.1', port))
                        while True:
                            r, _, _ = select.select([cs, rs], [], [])
                            if rs in r:
                                payload = rs.recv(1024)
                                if len(payload) == 0:
                                    break

                                cs.setblocking(True)
                                cs.send(payload)

                            if cs in r:
                                cs.setblocking(False)
                                try:
                                    payload = cs.recv(1024)
                                except ssl.SSLError as e:
                                    if e.errno != ssl.SSL_ERROR_WANT_READ:
                                        raise
                                    continue

                                if not payload:
                                    break

                                rs.send(payload)

                                data_left = cs.pending()
                                while data_left:
                                    rs.send(cs.recv(data_left))
                                    data_left = cs.pending()

            except Exception:
                demisto.debug(traceback.format_exc())
            finally:
                self.request.close()

        def handle(self):
            r, _, _ = select.select([self.request], [], [], 1)
            if self.request in r:
                h = self.request.recv(3, socket.MSG_PEEK)
                if h[:1] == b'\x16':
                    # TLS
                    self.forward_ssl_tcp(IMAP4_PORT)
                elif h[:1] == b'E':
                    # EHLO
                    self.forward_tcp_tcp(SMTP_PORT)
                elif h[:1] == b'H':
                    if h == b'HEL':
                        # HELO
                        self.forward_tcp_tcp(SMTP_PORT)
                    else:
                        # HEAD or default
                        self.forward_tcp_tcp(RAINLOOP_PORT)
                else:
                    self.forward_tcp_tcp(RAINLOOP_PORT)
            else:
                # Client is waiting for SMTP greeting
                self.forward_tcp_tcp(SMTP_PORT)
            self.request.close()


    ''' COMMAND FUNCTIONS '''


    def test_module(args, params):
        """
        Validates:
        """
        run_long_running(params, is_test=True)
        return 'ok', {}, {}


    def get_servcie_info_command(args, params):
        """
        Get the service information
        """
        sinfo = []

        x = demisto.getIntegrationContext() or {}
        addrs = x.get('ServerAddresses')
        if addrs:
            # Service is running
            sinfo = [{
                'IP': a['Host'],
                'Port': int(a['Port']),
                'Instance': demisto.integrationInstance(),
                'Status': 'Running'
            } for a in json.loads(addrs)]
        else:
            # Service is not running
            for ai in get_local_addresses():
                ip = str(ai['addr'])
                if ip not in ('127.0.0.1'):
                    sinfo.append({
                        'IP': ip,
                        'Name': demisto.integrationInstance(),
                        'Status': 'Not Running'
                    })

        if not sinfo:
            return 'Unable to get the service information', {}, {}

        hr = tblToMd('Service', sinfo)
        return hr, {'TsrainCompact.Service': sinfo}, sinfo


    def get_gateways_command(args, params):
        """
        Get gateway list
        """
        ifs = get_gateway_interfaces()
        if ifs:
            hr = tblToMd('Gateways', ifs)
            return hr, {'TsrainCompact.GW': ifs}, ifs
        else:
            hr = 'No gateway addresses'
            return hr, {}, []


    def get_default_admin_password_command(args, params):
        """
        Get default admin password
        """
        pwd = get_default_admin_password(params)
        return f'admin password: {pwd}', {}, pwd


    def restart_command(args, params):
        """
        Restart the core service
        """
        start_services(params, True)
        return 'The services have been restarted.', {}, {}


    def run_server(server: BaseServer, is_test=False):
        """
        Run the server

        :param server: The server instance
        :param is_test: Indicates whether it's test-module run or regular run
        :return: None
        """
        if is_test:
            svproc = Process(target=server.serve_forever)
            svproc.start()
            time.sleep(5)
            svproc.terminate()
        else:
            socket.setdefaulttimeout(DEFAULT_SOCKET_TIMEOUT)
            server.serve_forever()


    def run_long_running(params: Dict[str, Any], is_test=False):
        """
        Start the long running server

        :param params: Demisto params
        :param is_test: Indicates whether it's test-module run or regular run
        :return: None
        """
        try:
            longRunningPort = int(params['longRunningPort'])
            if longRunningPort < 0:
                raise ValueError(f'Invalid long running port: {longRunningPort}')
            if longRunningPort < 1024 or longRunningPort in (SMTP_PORT, POP3_PORT, IMAP4_PORT, RAINLOOP_PORT):
                raise ValueError(f'Listen ports less than 1024, {SMTP_PORT}, {POP3_PORT}, {IMAP4_PORT}'
                                 f' and {RAINLOOP_PORT} are reserved for system: {longRunningPort}')

            if not is_test:
                start_services(params, is_restart_required(params))
                update_context(params)

            # Run the server
            with ThreadingTCPServer(('', longRunningPort), PortForwardingHandler) as server:
                save_server_address(None, longRunningPort)
                run_server(server, is_test)
        except Exception as e:
            demisto.error(f'An error occurred in long running loop: {str(e)}')
            raise ValueError(str(e))
        finally:
            save_server_address(None, None)


    def main():
        """
        Main
        """
        params = demisto.params()

        command = demisto.command()
        demisto.debug('Command being called is {}'.format(command))
        commands = {
            'test-module': test_module,
            'tsrc-get-service-info': get_servcie_info_command,
            'tsrc-get-gateways': get_gateways_command,
            'tsrc-get-default-admin-password': get_default_admin_password_command,
            'tsrc-restart': restart_command
        }

        try:
            if command == 'long-running-execution':
                run_long_running(params)
            else:
                readable_output, outputs, raw_response = commands[command](demisto.args(), params)
                return_outputs(readable_output, outputs, raw_response)
        except Exception as e:
            err_msg = f'Error in {INTEGRATION_NAME} Integration [{e}]'
            return_error(err_msg)


    if __name__ in ['__main__', '__builtin__', 'builtins']:
        main()
  type: python
  commands:
  - name: tsrc-get-service-info
    arguments: []
    outputs:
    - contextPath: TsrainCompact.Service.IP
      description: The IP address on which the service is running
      type: string
    - contextPath: TsrainCompact.Service.Name
      description: The instance name of the service
      type: string
    - contextPath: TsrainCompact.Service.Port
      description: The port number on which the service is running
    - contextPath: TsrainCompact.Service.Status
      description: The service status
    description: Get the service information
  - name: tsrc-get-default-admin-password
    arguments: []
    description: Print default 'admin' password
  - name: tsrc-restart
    arguments: []
    description: Restart the services
  - name: tsrc-get-gateways
    arguments: []
    outputs:
    - contextPath: TsrainCompact.GW.IP
      description: The IP address of the gateway
      type: string
    - contextPath: TsrainCompact.GW.Interface
      description: The interface name
      type: string
    - contextPath: TsrainCompact.GW.Default
      description: True if the IP is Default gateway
      type: boolean
    description: Get gateway addresses of the instance running
  dockerimage: spearmint/xsoar-tsrain:2.9.16.1411
  runonce: false
  longRunning: true
  longRunningPort: true
  subtype: python3
sourcemoduleid: ExportIndicators
