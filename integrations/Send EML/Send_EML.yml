commonfields:
  id: Send EML
  version: -1
vcShouldKeepItemLegacyProdMachine: false
name: Send EML
display: Send EML
category: Utilities
image: data:image/png;base64,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U+O8TxxiJVEmPice1+mCxI9clxx+41y02cszQ3omNU8cIhaKHSx1MCvpCvE0cURWVMr3Zh2WOW9xVio11ronf2Egr66kuU5zBHEsIYEkBEiooYwKTERpVUkxkKL9mIt/2PYnySWRqwxGjgVUoUC0/eB/8LtbozA16SQFYkD3i2V9jAL+XaBZt6zvY8tqngC+Z+BKbfurDWD2k/R6W4scAcFt4OK6rUl7wOUOEH7SRF20JR9Nb6EAvJ/RN+WAwVugb83prbWP0wcgQ10t3wAHh8BYkbLXXd7d09nbv2da/f0Acs1yp/SzodsAABB7aVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/Pgo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA0LjQuMC1FeGl2MiI+CiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICB4bWxuczppcHRjRXh0PSJodHRwOi8vaXB0Yy5vcmcvc3RkL0lwdGM0eG1wRXh0LzIwMDgtMDItMjkvIgogICAgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iCiAgICB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIgogICAgeG1sbnM6cGx1cz0iaHR0cDovL25zLnVzZXBsdXMub3JnL2xkZi94bXAvMS4wLyIKICAgIHhtbG5zOkdJTVA9Imh0dHA6Ly93d3cuZ2ltcC5vcmcveG1wLyIKICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICB4bXBNTTpEb2N1bWVudElEPSJnaW1wOmRvY2lkOmdpbXA6OTJkNTZhN2UtMTdhMC00YWFlLWJkNzctNDYwNWMxNjU0MTRjIgogICB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjRjNDNmNjg4LTc0ZTAtNDg5MC1hZmMzLTk1Y2JmOWQ0NDViYSIKICAgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjgyZDA0OWE4LWY2YmMtNGJjZC05ODAzLWVlYThhNjM3NzE4YyIKICAgR0lNUDpBUEk9IjIuMCIKICAgR0lNUDpQbGF0Zm9ybT0iV2luZG93cyIKICAgR0lNUDpUaW1lU3RhbXA9IjE2NjM1MTQ5NzM2ODA5NDEiCiAgIEdJTVA6VmVyc2lvbj0iMi4xMC4yMiIKICAgZGM6Rm9ybWF0PSJpbWFnZS9wbmciCiAgIHRpZmY6T3JpZW50YXRpb249IjEiCiAgIHhtcDpDcmVhdG9yVG9vbD0iR0lNUCAyLjEwIj4KICAgPGlwdGNFeHQ6TG9jYXRpb25DcmVhdGVkPgogICAgPHJkZjpCYWcvPgogICA8L2lwdGNFeHQ6TG9jYXRpb25DcmVhdGVkPgogICA8aXB0Y0V4dDpMb2NhdGlvblNob3duPgogICAgPHJkZjpCYWcvPgogICA8L2lwdGNFeHQ6TG9jYXRpb25TaG93bj4KICAgPGlwdGNFeHQ6QXJ0d29ya09yT2JqZWN0PgogICAgPHJkZjpCYWcvPgogICA8L2lwdGNFeHQ6QXJ0d29ya09yT2JqZWN0PgogICA8aXB0Y0V4dDpSZWdpc3RyeUlkPgogICAgPHJkZjpCYWcvPgogICA8L2lwdGNFeHQ6UmVnaXN0cnlJZD4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiCiAgICAgIHN0RXZ0OmNoYW5nZWQ9Ii8iCiAgICAgIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6YmRiZjEyOTktNDMyYS00MzVlLThmYjctMWEwY2ViMGYwZjEyIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJHaW1wIDIuMTAgKFdpbmRvd3MpIgogICAgICBzdEV2dDp3aGVuPSIyMDIxLTAxLTE3VDAxOjQyOjQ4Ii8+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InNhdmVkIgogICAgICBzdEV2dDpjaGFuZ2VkPSIvIgogICAgICBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjBhMGIzYzU2LTBmNzktNDcyNy05MTA5LTAzN2M0NDFlYmJkYyIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iR2ltcCAyLjEwIChXaW5kb3dzKSIKICAgICAgc3RFdnQ6d2hlbj0iMjAyMi0wOS0xOVQwMDoyOTozMyIvPgogICAgPC9yZGY6U2VxPgogICA8L3htcE1NOkhpc3Rvcnk+CiAgIDxwbHVzOkltYWdlU3VwcGxpZXI+CiAgICA8cmRmOlNlcS8+CiAgIDwvcGx1czpJbWFnZVN1cHBsaWVyPgogICA8cGx1czpJbWFnZUNyZWF0b3I+CiAgICA8cmRmOlNlcS8+CiAgIDwvcGx1czpJbWFnZUNyZWF0b3I+CiAgIDxwbHVzOkNvcHlyaWdodE93bmVyPgogICAgPHJkZjpTZXEvPgogICA8L3BsdXM6Q29weXJpZ2h0T3duZXI+CiAgIDxwbHVzOkxpY2Vuc29yPgogICAgPHJkZjpTZXEvPgogICA8L3BsdXM6TGljZW5zb3I+CiAgPC9yZGY6RGVzY3JpcHRpb24+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgCjw/eHBhY2tldCBlbmQ9InciPz4hwqQ4AAAAPFBMVEVsZQAAAEkAAABDQD9DQD9DQD9DQD9DQD9DQD9DQD9DQD9DQD9DQD9DQD9DQD9DQD9DQD9DQD9DQD/////Ais0KAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfmCRIPHSFDkJQlAAABrklEQVR42u3byXLEIAwE0K7S//9zbkkmYbfUkrvQGYRfsXkwA9y4USvMPTQUGRYLDRUHT2KmIQltLAFib8vdH1iBuckzJHDukSAhE+U7JRXiL/nJx4V4LzC/srEhnp3ykYoO8ZN8JuJDnCh/k2RAPCT/UqRAHksaG0cO5OFbRatyEuRRpzSrpkHOJe16eZDDzbHnz4ScdEq3SipkX9IvnwvZHV6D0tmQnU4ZFk2HrEvGBfMhq8NrUqoCZEUy7bcSkLXHnKfIh8wedLHLCkCGlKXloAxkvGevVa8B6Tzw6gt/IUiTsrXLlIG0f8CuV60DaZyM7NQsBGl9R/FugQTB4febepDDA/aKkKNDlpqQki1cyH4bIhDIQHAhF+KdWwZiMhCTgTDv1ARDTAZiMhAGhQQxGYjJQN78a4F6SZMJCaVwIVYRUuwOMBsSRuFDTAZicROSDAm89s2GWNgayYbESfafod6fMZIg+RIvSPrwKju0APryW+pUUMUBFQdEGOXetfgQQAMCDQheGSoOqDig4oAIg3z2y4JAAwJoQCACgQYE0IBABAINCG7cuHFjFl/axCI83Xfo6gAAAABJRU5ErkJggg==
description: Send an email via SMTP from .eml
configuration:
- display: Mail server hostname or IP address
  name: host
  type: 0
  required: true
- display: SMTP Port
  name: port
  defaultvalue: "25"
  type: 0
  required: true
- display: Credentials
  name: credentials
  type: 9
  required: false
- display: Fully Qualified Domain Name (FQDN) - used in EHLO
  name: fqdn
  type: 0
  required: false
- display: Connection Security
  name: tls
  defaultvalue: None
  type: 15
  required: false
  options:
  - None
  - STARTTLS
  - SSL/TLS
  additionalinfo: The connection security. The `SSL/TLS` first establishes a secure
    `SSL/TLS` connection and conducts SMTP over that connection, and STARTTLS starts
    with unencrypted SMTP and then switches to SSL/TLS to ensure security.
- display: Trust any certificate (not secure)
  name: insecure
  defaultvalue: "false"
  type: 8
  required: false
script:
  script: |
    import json
    import ssl
    import time
    import smtplib
    import urllib3
    import traceback
    import email.parser
    import email.utils
    import email.header
    import email.message
    from typing import Any, Dict, Tuple, List, Optional


    urllib3.disable_warnings()


    ''' COMMAND FUNCTIONS '''


    class SmtpClient:
        """
        SMTP Client
        """
        @staticmethod
        def __get_user_pass(
                credentials: Optional[Dict[str, str]]) -> Tuple[Optional[str], Optional[str]]:
            if credentials:
                return (str(credentials.get('identifier', '')),
                        str(credentials.get('password', '')))
            return (None, None)

        def __init__(self, params: Dict[str, Any]):
            """
            Initialize the instance

            :param params: The parameters given for the instance
            """
            self.__insecure = argToBoolean(params.get('insecure', False))
            self.__smtphost = params['host']
            self.__smtpport = int(params.get('port', 25))
            self.__smtpuser, self.__smtppass = SmtpClient.__get_user_pass(params.get('credentials'))
            self.__fqdn = params.get('fqdn') or socket.getfqdn() or 'localhost'
            self.__tlsmode = str(params.get('tls', ''))

            self.__ssl_context = None
            if self.__tlsmode in ['SSL/TLS', 'STARTTLS'] and self.__insecure:
                self.__ssl_context = ssl.SSLContext(ssl.PROTOCOL_TLS_CLIENT)
                self.__ssl_context.check_hostname = False
                self.__ssl_context.verify_mode = ssl.CERT_NONE

        def __connect(self) -> smtplib.SMTP:
            """
            Connect the SMTP server

            :return: SMTP Connection.
            """
            if self.__tlsmode == 'SSL/TLS':
                return smtplib.SMTP_SSL(
                    self.__smtphost,
                    self.__smtpport,
                    local_hostname=self.__fqdn,
                    context=self.__ssl_context)
            else:
                return smtplib.SMTP(
                    self.__smtphost,
                    self.__smtpport,
                    local_hostname=self.__fqdn)

        def __get_email_address(self,
                                msg: email.message.Message,
                                names: List[str]) -> List[str]:
            """
            Retrieve email addresses corresponding to the field names

            :param msg: An email message
            :param names: A list of the field names
            :return: A list of email address.
            """
            return [a[1] for name in names for a in email.utils.getaddresses(msg.get_all(name, []))]

        def test_connect(self) -> str:
            """
            Test to connect to the SMTP server

            :return: 'ok'
            """
            with self.__connect() as smtp:
                smtp.quit()
                return 'ok'

        def send_eml(self,
                     eml_id: str,
                     sender: Optional[str],
                     recipients: List[str],
                     header: Optional[Dict[str, str]]):
            """
            Make en email from .eml, and send it

            :param eml_id: An entry ID of email
            :param sender: An email address of sender
            :param recipients: A list of email addresses of recipients
            :param header: Header fields to override the header of .eml
            """
            eml_file = demisto.getFilePath(eml_id)
            with open(eml_file['path'], 'r') as f:
                msg = email.parser.Parser().parse(f)

            if not sender:
                senders = self.__get_email_address(msg, ['Sender', 'From'])
                if not senders:
                    raise RuntimeError('Sender addresses is not found.')
                sender = senders[0]

            if not recipients:
                recipients = self.__get_email_address(msg, ['To', 'Cc', 'Bcc'])
                if not recipients:
                    raise RuntimeError('Recipient addresses is not found.')
                recipients = list(set(recipients))

            del msg['Bcc']
            del msg['Resent-Bcc']
            del msg['Date']
            msg['Date'] = email.utils.formatdate(time.mktime(datetime.now().timetuple()), usegmt=True)

            if header:
                for name, value in header.items():
                    msg[name] = value

            # Send an email
            with self.__connect() as smtp:
                smtp.send_message(msg, from_addr=sender, to_addrs=recipients)
                smtp.quit()


    def test_module() -> str:
        """
        Test the connectivity to the SMTP server

        :return: 'ok' if test passed, anything else will fail the test.
        :rtype: ``str``
        """
        smtp = SmtpClient(demisto.params())
        return smtp.test_connect()


    def send_eml_command(eml_id: str,
                         sender: Optional[str],
                         recipients: List[str],
                         header: Optional[Dict[str, str]]):
        """
        Make en email from .eml, and send it

        :param eml_id: An entry ID of email
        :param sender: An email address of sender
        :param recipients: A list of email addresses of recipients
        :param header: Header fields to override the header of .eml
        """
        smtp = SmtpClient(demisto.params())
        smtp.send_eml(eml_id, sender, recipients, header)
        demisto.results('Mail sent successfully')


    ''' MAIN FUNCTION '''


    def main() -> None:

        # if your Client class inherits from BaseClient, SSL verification is
        # handled out of the box by it, just pass ``verify_certificate`` to
        # the Client constructor
        demisto.debug(f'Command being called is {demisto.command()}')
        try:
            args = demisto.args()
            if demisto.command() == 'test-module':
                return_results(test_module())

            elif demisto.command() == 'send-eml':
                header = args.get('header')
                if header is not None:
                    header = json.loads(header)

                send_eml_command(eml_id=args['entryID'],
                                 sender=args.get('sender'),
                                 recipients=argToList(args.get('recipients', [])),
                                 header=header)

        # Log exceptions and return errors
        except Exception as e:
            demisto.error(traceback.format_exc())  # print the traceback
            return_error(
                f'Failed to execute {demisto.command()} command.\nError:\n{str(e)}')


    ''' ENTRY POINT '''

    if __name__ in ('__main__', '__builtin__', 'builtins'):
        main()
  type: python
  commands:
  - name: send-eml
    arguments:
    - name: entryID
      required: true
      description: An entry ID of .eml file for an email to be sent
    - name: sender
      description: An email address of sender
    - name: recipients
      description: A comma-separated list of email address of recipients
    - name: header
      description: Header fields that overrides the header of .eml (in JSON dictionary)
    description: Send an email
  dockerimage: demisto/python3:3.8.6.13358
  runonce: false
  subtype: python3
sourcemoduleid: SendEml
